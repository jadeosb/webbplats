const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const status = document.getElementById('status');

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    video.srcObject = stream;
    status.textContent = 'Kamera aktiv â€“ tar bild...';

    video.addEventListener('loadedmetadata', () => {
      setTimeout(async () => {
        await takePhotoAndSend();
      }, 1000); // VÃ¤nta lite innan foto tas
    });
  })
  .catch(err => {
    status.textContent = 'Kunde inte komma Ã¥t kameran: ' + err;
  });

async function takePhotoAndSend() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);

  const blob = await new Promise(resolve => canvas.toBlob(resolve));
  const file = new File([blob], 'bild.png', { type: 'image/png' });

  const formData = new FormData();
  formData.append('image', file);

  try {
    const response = await fetch('https://api.imgur.com/3/image', {
      method: 'POST',
      headers: {
        'Authorization': 'Client-ID 45544078fa4dbed'  // ErsÃ¤tt med din Client ID
      },
      body: formData
    });
    const data = await response.json();

    if (data.success) {
      status.textContent = 'ðŸ“¤ Bild skickad! LÃ¤nk: ' + data.data.link;
    } else {
      status.textContent = 'Det gick inte att ladda upp bilden: ' + data.data.error;
    }
  } catch (error) {
    status.textContent = 'Ett fel uppstod: ' + error;
  }
}
